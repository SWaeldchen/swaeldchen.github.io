---
layout: post
title:  "Interactive Classification 3: Asymmetric Feature Correlation"
date:   2023-01-04 00:00:00 +0100
categories: [research]
tags: [optimization, ml, uniform convexity, abstract]
math: true
comments: true
giscus_comments: true
author: Stephan WÃ¤ldchen
---


{% include abbrv.html %}

<style>
  .figcap {
    font-size: 0.9em;
  }
</style>

This post is part 3 of my series on <a href="/blog/2023/FI_start/">Interactive Classification</a>.

*TL;DR:
We give an intuitive understanding of Asymmetric Feature Correlation
1. Asymmetric Feature Correlation
1. Relative strength of cooperative and adversarial prover
1. Do we need a game equilibrium?
<!--more-->


### Asymmetric Feature Correlation

 AFC describes a possible quirk of datasets, where a set of features is strongly concentrated in a few data points in one class and spread out over almost all data points in another. We give an illustrative example in Figure 1.

<div style="display: flex; justify-content: center;">
  <img src="{{site.url }}{{site.baseurl }}/assets/img/merlin_arthur/afc.svg" alt="img1" style="float:center; width:100%">
  <p style="clear: both;"></p>
</div>
<br>
**Figure 1.** Example of a dataset an AFC $\kappa=6$. The ''fruit'' features are concentrated in one image for class $l=-1$ but spread out over six images for $l=1$ (vice versa for the ''fish'' features). Each individual feature is not indicative of the class as it appears exactly once in each class. Nevertheless, Arthur and Merlin can exchange ''fruits'' to indicate $l=1$ and ''fish'' for $l=-1$. The images where this strategy fails or can be exploited by Morgana are the two images on the left. Applyingour min-max theorem, we get $\epsilon_M = \frac{1}{7}$ and the set $D^{\prime}$ corresponds to all images with a single feature. Restricted to $D^{\prime}$, the features determine the class completely.
{:.figcap}

**Possile Exploit:** In this example, Merlin and Arthur can agree to exchange a fruit features to indicate class 1. Arthur can always be convinced by Merlin except in the one image with many fish. Likewise, the one image with the many fruit is the only one where he can be falsely convinced of class 1 by Morgana. This applies vice versa to class -1, where they exchange fish features. Thus the set $E_{M,\widehat{M},A}$ is only the two images on the left with the many features and

$$\epsilon_M = \frac{1}{7}.$$

But the features are individually uninformative! Each fish and fruit appear equally likely in both classes and thus $\ap_{\CD}(M)=\frac{1}{2}$. The bound

$$
  \ap_{\CD}(M) \geq 1-\epsilon_{M}
$$

thus needs to fail. In fact, $$\epsilon_M$$ can be made arbitrarily small as long as one can fit more features into the datapoints.
This means that that the AFC necessarily has to be taken into account if we want to derive a bound on the informativeness of the features.

<div style="display: flex; justify-content: center;">
  <img src="{{site.url }}{{site.baseurl }}/assets/img/merlin_arthur/select.svg" alt="img1" style="float:center; width:40%">
  <p style="clear: both;"></p>
</div>
<br>
**Figure 1.** Conditioned on any of the fish or fruit features the probability of being in either class are exactly the same. Thus the features are not informative of the class. Even so, they can be successfully leveraged by Merlin and Arthur.
{:.figcap}

In the <a href="/blog/2023/FI_Merlin-Arthur/#a-min-max-theorem"> min-max theorem </a> we save ourselves by definiting the slightly smaller set $D^\prime$.
In our example with the fruit and fish, $D^\prime$ is the set of all the images with a single feature. It is easy to check that this set covers a $1-\epsilon_M$ portion of the original set and that conditioned on it the fish and fruit features determine the class completely.


If we want a bound that does not rely on a restricted set, we need to include the asymmetric feature correlation explicitely. We can formally define it as follows:

**Asymmetric Feature Correlation:** The AFC $\kappa$ of a dataset $D$ is defined as:

$$
\kappa = \max_{l\in \{-1,1\}} \max_{F \subset \Sigma} \E_{\bfy \sim \CD_l|_{F^*}}\ekl{\max_{\substack{\phi \in F \\ \text{s.t. }\bfy \in \phi}}\kappa_l(\phi, F)}
$$

with

$$
  \kappa_l(\phi, F) = \frac{\P_{\bfx \sim \CD_{-l}}\ekl{\bfx \in \phi  \,\middle|\, \bfx \in F^*}}{\P_{\bfx \sim \CD_l}\ekl{\bfx \in \phi \,\middle|\, \bfx \in F^*}}.
$$

where
$$F^\ast := \left\{\bfx \in D~|~ \exists~ \phi \in F: \phi \subseteq \bfx\right\}$$
is the set of all datapoins with a feature from $F$.

**Intuition:** The probability
$$\P_{\bfx \sim \CD_{l}}\ekl{\bfx \in \phi \,\middle|\, \bfx \in F^*}$$
for $\phi\in F$
 is a measure of how correlated the features are. If all features appear in the same datapoints this quantity takes a maximal value of 1 for each $\phi$. If no features share the same datapoint the value is minimally $\frac{1}{\bkl{F}}$ for the average $\phi$.
The $\kappa_l(\phi, F)$ thus measures the difference in correlation between the two classes. In the example in~\Cref{fig:afc} the worst-case $F$ for $l=-1$ correspond to the ''fish'' features and $\kappa_l(\phi, F)=6$ for each feature.
To take an expectation over the features $\phi$ requires a distribution, so we take the distribution of datapoints that have a feature from $F$, i.e. $\bfy \sim \CD_l|_{F^*}$, and select the worst-case feature from each datapoint. Then we maximise over class and the possible feature sets $F$.
Since, in Figure 5, the ''fish'' and ''fruit'' features are the worst case for each class respectively, we arrive at an AFC of 6.

This definition allows us to later state our main theorem.

#### How large can the AFC get?

In the fish-and-fruit example we created an AFC of six by putting six features into a single image. As it turns out, one can actually prove that the maximum number of features per datapoint upper bounds the AFC.

**Lemma** Let $D$ be a dataset with feature space $\Sigma$ and AFC of $\kappa$. Let
$$K = \max_{\bfx \in D}\, \bkl{\skl{\phi \in \Sigma \,|\, \bfx \in \phi}}$$ be the maximum number of features per data point. Then

$$
\kappa \leq K.
$$

The maximum number of features per datapoint depends on the feature space $\Sigma$. For example, text data of sentences of length $d$, where every consecutive set of words is a feature, have a maximum feature count of $d^2$.
However, when we consider every valid subset of input parameters of a datapoint as a possible feature for Merlin and Arthur to exchange, $K$ becomes exponential in the input dimension and is easy to construct an example dataset with an exponentially large AFC.

<div style="display: flex; justify-content: center;">
  <img src="{{site.url }}{{site.baseurl }}/assets/img/merlin_arthur/red_and_blue.svg" alt="img1" style="float:center; width:100%">
  <p style="clear: both;"></p>
</div>
<br>
**Figure 1.** An example of a dataset with very high asymmetric feature correlation. The completely red image shares a feature with each of the $m$-red-pixel images (here $m=5$), of which there are $\binom{d}{m}$ many. In the worst case $m=\frac{d}{2}$, resulting in $k=\binom{d}{d/2}$ thus exponential growth in $d$.
{:.figcap}
<br>

#### Computational Hardness

Just as it is computationally hard to determine the AFC of a dataset, it is also computationally hard to exploit. This holds at least if one wants to come close to the optimal level, as we show in our [paper](https://arxiv.org/pdf/2306.04505.pdf). We formalise the dataset with the feature space as a tri-partite graph. The problem of Merlin and Arthur deceptively choosing feature with low precision to ensure high completeness and soundness can then be modelled as a graph problem. We prove that this problem ist (expectedly) $\SNP$-hard, but also give an inapproximability barrier.

This does not, however, mean that the problem will be hard on average, as this is a worst-case complexity analysis.

#### Learnability

Learnability is another barrier to exploit the AFC. Merlin and Arthur's strategy needs to carry over from the train to the test dataset. That means: They might find some clever set of features by optimising over the train dataset, but if this set does not generalis to the test datset they will not achieve high completeness and soundness there.

So far, however, this has analysis is highly speculative and has not been verified in real-world dataset.

### Key Takeaways
The above theoretical discussion shows two key contributions of our framework.
1. The Asymmetric Feature Correlation is a necessary consideration of a dataset to connect Merlin-Arthur completeness and soundness with high feature precision
1. We do not expect this issue in practice for the following reasons:
    1. The AFC can be circumvented using a slightly reduced dataset as in the min-max Theorem,
    1. Exploiting the AFC faces a computational and a learnability barrier.



{% bibliography --cited --file formal_interpretability.bib --template bib2 %}
